"use strict";

function convertStrToObj(str) {
  if (!str) {
    return {};
  }

  return JSON.parse(str);
}

$('#buyR').click(function () {
  location.href = 'cart.min.html';
});
$('#add').click(function (event) {
  console.log(1);
  var good_id = $('.rig').attr('data-good-id');
  var good_name = $('.rig h3').children('#gname').html();
  var good_price = $('.money').html(); // console.log(good_id,good_name)

  var cookie_str = getCookie('carts') ? getCookie('carts') : '';
  var cookie_obj = convertStrToObj(cookie_str);
  var cookie_num = $('.ip').val();
  cookie_num++;
  $('.ip').val(cookie_num);
  console.log(cookie_obj);

  if (good_id in cookie_obj) {
    cookie_obj[good_id].num++;
  } else {
    cookie_obj[good_id] = {
      name: good_name,
      price: good_price,
      num: 1
    };
  }

  createCookie('carts', JSON.stringify(cookie_obj), {
    expires: 1,
    path: '/'
  });
});

function init() {
  //获取cookie
  var cookie_str = getCookie('carts') ? getCookie('carts') : ''; //转对象

  var cookie_obj = convertStrToObj(cookie_str); //总和

  var sum = 0;

  for (var key in cookie_obj) {
    sum += cookie_obj[key].num;
  }

  $('.ip').val("".concat(sum));
  $('.cat').html(" \u8D2D\u7269\u8F66\uFF1A\n    <b>".concat(sum, "</b>\n    \u4EF6"));
}

$(function () {
  init();
});
$('#reduce').click(function (event) {
  console.log(1);
  var good_id = $('.rig').attr('data-good-id');
  var good_name = $('.rig h3').children('#gname').html();
  var good_price = $('.money'); // console.log(good_id,good_name)

  var cookie_str = getCookie('carts') ? getCookie('carts') : '';
  var cookie_obj = convertStrToObj(cookie_str);
  var cookie_num = $('.ip').val();
  cookie_num--;
  $('.ip').val(cookie_num);

  if (/^\d+$/.test($('.ip').val(cookie_num))) {
    cookie_obj[good_id].num = $('.ip').val(cookie_num);
  } else {
    cookie_obj[good_id].num = 0;
  }

  console.log(cookie_obj);

  if (good_id in cookie_obj) {
    cookie_obj[good_id].num--;
  } else {
    cookie_obj[good_id] = {
      name: good_name,
      price: good_price,
      num: 1
    };
  }

  createCookie('carts', JSON.stringify(cookie_obj), {
    expires: 1,
    path: '/'
  });
});

function info() {
  //获取cookie
  var cookie_str = getCookie('carts') ? getCookie('carts') : ''; //转对象

  var cookie_obj = convertStrToObj(cookie_str); //总和

  var sum = 0;

  for (var key in cookie_obj) {
    sum += cookie_obj[key].num;
  }

  $('.ip').val("".concat(sum));
  $('.cat').html(" \u8D2D\u7269\u8F66\uFF1A\n    <b>".concat(sum, "</b>\n    \u4EF6"));
}

$(function () {
  info();
});